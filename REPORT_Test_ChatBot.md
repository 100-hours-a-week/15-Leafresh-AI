## ğŸš€ CoT(Chain of Thought) í…ŒìŠ¤íŠ¸ with Langfuse

ì´ í”„ë¡œì íŠ¸ëŠ” Langfuseë¥¼ ì‚¬ìš©í•˜ì—¬ CoT ë°©ì‹ìœ¼ë¡œ ì±—ë´‡ ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ê³  í‰ê°€í•©ë‹ˆë‹¤.

### ğŸ“‹ CoT í…ŒìŠ¤íŠ¸ë€?

CoT(Chain of Thought)ëŠ” LLMì´ ë‹¨ê³„ë³„ë¡œ ì‚¬ê³  ê³¼ì •ì„ ë³´ì—¬ì£¼ë©´ì„œ ë‹µì„ ë„ì¶œí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´:

- **ì‚¬ê³  ê³¼ì •ì˜ íˆ¬ëª…ì„±**: AIê°€ ì–´ë–»ê²Œ ê²°ë¡ ì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸ ê°€ëŠ¥
- **ë…¼ë¦¬ì  ì¶”ë¡ **: ë‹¨ê³„ë³„ ì‚¬ê³  ê³¼ì •ì„ í†µí•œ ì •í™•í•œ ë‹µë³€
- **ì„±ëŠ¥ í‰ê°€**: ì‚¬ê³  ê³¼ì •ì˜ í’ˆì§ˆì„ ê°ê´€ì ìœ¼ë¡œ ì¸¡ì •

### ğŸ› ï¸ ì„¤ì • ë°©ë²•

1. **Langfuse ê³„ì • ìƒì„±**
   - [Langfuse Cloud](https://cloud.langfuse.com)ì—ì„œ ê³„ì • ìƒì„±
   - API í‚¤ ë°œê¸‰ (Public Key, Secret Key)

2. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
   ```bash
   # .env íŒŒì¼ì— ì¶”ê°€
   LANGFUSE_PUBLIC_KEY=your_langfuse_public_key_here
   LANGFUSE_SECRET_KEY=your_langfuse_secret_key_here
   LANGFUSE_HOST=https://cloud.langfuse.com
   ```

3. **ì˜ì¡´ì„± ì„¤ì¹˜**
   ```bash
   pip install -r requirements.txt
   ```

### ğŸ§ª CoT í…ŒìŠ¤íŠ¸ ì‹¤í–‰

1. **ì„œë²„ ì‹¤í–‰**
   ```bash
   uvicorn main:app --port 8000
   ```

2. **CoT í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
   ```bash
   python cot_test_runner.py
   ```

### ğŸ“Š í‰ê°€ ê¸°ì¤€

CoT í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ìŒ 4ê°€ì§€ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤:

| í‰ê°€ í•­ëª© | ê°€ì¤‘ì¹˜ | ì„¤ëª… |
|-----------|--------|------|
| **ì‚¬ê³  ê³¼ì •** | 40% | CoT í‚¤ì›Œë“œ í¬í•¨ ì—¬ë¶€, ì˜ˆìƒ í‚¤ì›Œë“œ ë§¤ì¹­ |
| **ì¶”ë¡  ë‹¨ê³„** | 30% | ë‹¨ê³„ë³„ ì‚¬ê³ ê°€ ëª…í™•í•œì§€ |
| **ë…¼ë¦¬ì  íë¦„** | 20% | ë…¼ë¦¬ì  ì—°ê²°ì–´ ì‚¬ìš©, ìì—°ìŠ¤ëŸ¬ìš´ íë¦„ |
| **ì™„ì„±ë„** | 10% | ì‘ë‹µ ê¸¸ì´, ì¶©ë¶„í•œ ì„¤ëª… |

### ğŸ“ˆ ê²°ê³¼ í™•ì¸

1. **ì½˜ì†” ì¶œë ¥**: ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸
2. **Markdown ë¦¬í¬íŠ¸**: `cot_test_report.md` íŒŒì¼ ìƒì„±
3. **Langfuse ëŒ€ì‹œë³´ë“œ**: ìƒì„¸í•œ ë¶„ì„ ë° ì‹œê°í™”

### ğŸ” Langfuse ëŒ€ì‹œë³´ë“œ í™œìš©

- **Trace ì¡°íšŒ**: ê° í…ŒìŠ¤íŠ¸ì˜ ìƒì„¸ ê³¼ì • í™•ì¸
- **ì„±ëŠ¥ ë¶„ì„**: ì ìˆ˜ ì¶”ì´ ë° íŒ¨í„´ ë¶„ì„
- **A/B í…ŒìŠ¤íŠ¸**: ë‹¤ì–‘í•œ í”„ë¡¬í”„íŠ¸ ë¹„êµ
- **ì•Œë¦¼ ì„¤ì •**: ì„±ëŠ¥ ì €í•˜ ì‹œ ìë™ ì•Œë¦¼

### ğŸ“ íŒŒì¼ êµ¬ì¡°

```
â”œâ”€â”€ langfuse_config.py      # Langfuse ì„¤ì • ë° í‰ê°€ ë¡œì§
â”œâ”€â”€ cot_test_data.py        # CoT í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë° í”„ë¡¬í”„íŠ¸
â”œâ”€â”€ cot_test_runner.py      # í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ cot_test_report.md      # í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸ (ìƒì„±ë¨)
â””â”€â”€ requirements.txt        # ì˜ì¡´ì„± íŒ¨í‚¤ì§€
```

### ğŸ¯ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

í˜„ì¬ í¬í•¨ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤:

1. **ê¸°ë³¸ ì •ë³´ ê¸°ë°˜ ì¶”ì²œ** (`test_001`)
   - ìœ„ì¹˜: ì„œìš¸, ì§ì—…: íšŒì‚¬ì›, ì¹´í…Œê³ ë¦¬: ì—ë„ˆì§€ì ˆì•½

2. **ììœ  í…ìŠ¤íŠ¸ - íƒ„ì†Œë°œìêµ­** (`test_002`)
   - "ì§‘ì—ì„œ íƒ„ì†Œë°œìêµ­ì„ ì¤„ì´ê³  ì‹¶ì–´ìš”"

3. **ììœ  í…ìŠ¤íŠ¸ - ì¼íšŒìš©í’ˆ** (`test_003`)
   - "ì¼íšŒìš©í’ˆ ì‚¬ìš©ì„ ì¤„ì´ê³  ì‹¶ì€ë° ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?"

### ğŸ”§ ì»¤ìŠ¤í„°ë§ˆì´ì§•

ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€:

```python
# cot_test_data.pyì— ì¶”ê°€
{
    "id": "test_004",
    "category": "free_text",
    "input": {
        "message": "ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€"
    },
    "expected_keywords": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"],
    "cot_prompt": "ë‹¨ê³„ë³„ ì‚¬ê³  ê³¼ì •ì„ í¬í•¨í•œ í”„ë¡¬í”„íŠ¸..."
}
```

í‰ê°€ ê¸°ì¤€ ìˆ˜ì •:

```python
# langfuse_config.pyì˜ CoTEvaluator í´ë˜ìŠ¤ì—ì„œ ìˆ˜ì •
def evaluate_thought_process(self, trace_id: str, response: str, expected_keywords: List[str]) -> float:
    # ì»¤ìŠ¤í…€ í‰ê°€ ë¡œì§ êµ¬í˜„
    pass
```

### ğŸ“ ì§€ì›

ë¬¸ì œê°€ ìˆê±°ë‚˜ ê°œì„  ì‚¬í•­ì´ ìˆìœ¼ë©´ ì´ìŠˆë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”!

---

## ê¸°ì¡´ API ë¬¸ì„œ

### ì—”ë“œí¬ì¸íŠ¸

- `POST /ai/chatbot/recommendation/base-info` - ê¸°ë³¸ ì •ë³´ ê¸°ë°˜ ì±Œë¦°ì§€ ì¶”ì²œ
- `POST /ai/chatbot/recommendation/free-text` - ììœ  í…ìŠ¤íŠ¸ ê¸°ë°˜ ì±Œë¦°ì§€ ì¶”ì²œ
- `POST /ai/censorship` - ì½˜í…ì¸  ê²€ì—´
- `POST /ai/feedback` - í”¼ë“œë°± ì²˜ë¦¬
- `GET /health` - í—¬ìŠ¤ ì²´í¬

### ì‚¬ìš© ì˜ˆì‹œ

```bash
# ê¸°ë³¸ ì •ë³´ ê¸°ë°˜ ì¶”ì²œ
curl -X POST "http://localhost:8000/ai/chatbot/recommendation/base-info" \
  -H "Content-Type: application/json" \
  -d '{
    "location": "ì„œìš¸",
    "workType": "íšŒì‚¬ì›", 
    "category": "ì—ë„ˆì§€ì ˆì•½"
  }'

# ììœ  í…ìŠ¤íŠ¸ ê¸°ë°˜ ì¶”ì²œ
curl -X POST "http://localhost:8000/ai/chatbot/recommendation/free-text" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ì§‘ì—ì„œ íƒ„ì†Œë°œìêµ­ì„ ì¤„ì´ê³  ì‹¶ì–´ìš”"
  }'
```